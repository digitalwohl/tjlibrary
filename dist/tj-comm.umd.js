!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t||self).tjComm={})}(this,function(t){function n(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n)}function i(t,n){return i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},i(t,n)}let s=t=>crypto.getRandomValues(new Uint8Array(t));var o=/*#__PURE__*/function(){function t(t,n,i){this.id=void 0,this.domain=void 0,this.action=void 0,this.data=void 0,this.domain=t,this.action=n,this.data=i,this.id=this.generateId()}return t.prototype.generateId=function(){return((t,n,i)=>{let s=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*s*16/t.length);return()=>{let n="";for(;;){let e=i(o),r=o;for(;r--;)if(n+=t[e[r]&s]||"",16===n.length)return n}}})("1234567890",0,s)()},t}(),e=/*#__PURE__*/function(){function t(){this.PARENT_TARGET_ORIGIN="https://localhost/tabjail/sandbox"}var n=t.prototype;return n.sendSandboxEvent=function(t){window.parent.postMessage(t,this.PARENT_TARGET_ORIGIN)},n.registerSubscription=function(t,n){var i=new o(t,n);this.sendSandboxEvent(i)},t}(),r=/*#__PURE__*/function(){function t(t){this.resolve=void 0,this.reject=void 0,this.sandboxEvent=void 0,this.sandboxEvent=t}var n=t.prototype;return n.createPromise=function(){var t=this;return new Promise(function(n,i){t.resolve=n,t.reject=i})},n.resolvePromise=function(t){this.resolve(t)},n.rejectPromise=function(t){this.reject(t)},t}(),h=/*#__PURE__*/function(t){function i(){for(var n,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=t.call.apply(t,[this].concat(s))||this).DOMAIN="extension",n.ACTIONS={GET_ALL_WINDOWS:"getAllWindows",ON_BOUNDS_CHANGED_WINDOWS:"onBoundsChangedWindows",ON_CREATED_WINDOWS:"onCreatedWindows",ON_FOCUS_CHANGED_WINDOWS:"onFocusChangedWindows",ON_REMOVED_WINDOWS:"onRemovedWindows"},n.pendingRequests=[],n.onBoundsChangedCallbacks=[],n.onCreatedCallbacks=[],n.onFocusChangedCallbacks=[],n.onRemovedCallbacks=[],n}n(i,t);var s=i.prototype;return s.getAll=function(){var t=new o(this.DOMAIN,this.ACTIONS.GET_ALL_WINDOWS),n=new r(t);return this.pendingRequests.push(n),this.sendSandboxEvent(t),n.createPromise()},s.onBoundsChanged=function(t){this.registerSubscription(this.DOMAIN,this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS),this.onBoundsChangedCallbacks.push(t)},s.onCreated=function(t){this.registerSubscription(this.DOMAIN,this.ACTIONS.ON_CREATED_WINDOWS),this.onCreatedCallbacks.push(t)},s.onFocusChanged=function(t){this.registerSubscription(this.DOMAIN,this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS),this.onFocusChangedCallbacks.push(t)},s.onRemoved=function(t){this.registerSubscription(this.DOMAIN,this.ACTIONS.ON_REMOVED_WINDOWS),this.onRemovedCallbacks.push(t)},s.onEventFromSandbox=function(t){if(t.domain===this.DOMAIN)switch(t.action){case this.ACTIONS.GET_ALL_WINDOWS:var n=this.pendingRequests.find(function(n){return n.sandboxEvent.id===t.id}),i=this.pendingRequests.findIndex(function(n){return n.sandboxEvent.id===t.id});n&&(n.resolvePromise(t.data),this.pendingRequests.splice(i,1));break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onBoundsChangedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_CREATED_WINDOWS:this.onCreatedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS:this.onFocusChangedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onRemovedCallbacks.forEach(function(n){return n(t.data)})}},i}(e),u=/*#__PURE__*/function(){function t(){this.windows=new h}return t.prototype.onEventFromSandbox=function(t){this.windows.onEventFromSandbox(t)},t}(),f=/*#__PURE__*/function(t){function i(){for(var n,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=t.call.apply(t,[this].concat(s))||this).DOMAIN="sandbox",n.ACTIONS={JAIL_PAGE:"jailPage",READY:"isReady"},n.pendingRequests=[],n}n(i,t);var s=i.prototype;return s.ready=function(){var t=new o(this.DOMAIN,this.ACTIONS.JAIL_PAGE),n=new r(t);return this.pendingRequests.push(n),this.sendSandboxEvent(t),this.registerSandboxEventsListener(),n.createPromise()},s.onEventFromSandbox=function(t){if(t.domain===this.DOMAIN&&t.action===this.ACTIONS.READY){var n=this.pendingRequests.find(function(n){return n.sandboxEvent.id===t.id}),i=this.pendingRequests.findIndex(function(n){return n.sandboxEvent.id===t.id});n&&(n.resolvePromise(!0),this.pendingRequests.splice(i,1))}},s.registerSandboxEventsListener=function(){window.addEventListener("message",function(t){a.onEventFromSandbox(t.data)},!1)},i}(e),c=/*#__PURE__*/function(){function t(){this.general=new f}return t.prototype.onEventFromSandbox=function(t){this.general.onEventFromSandbox(t)},t}(),a=/*#__PURE__*/function(){function t(){}return t.onEventFromSandbox=function(t){this.sandbox.onEventFromSandbox(t),this.chrome.onEventFromSandbox(t)},t}();a.chrome=new u,a.sandbox=new c,t.TJ=a});
//# sourceMappingURL=tj-comm.umd.js.map
