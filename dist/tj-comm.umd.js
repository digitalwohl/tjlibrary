!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n||self).tjComm={})}(this,function(n){let t=n=>crypto.getRandomValues(new Uint8Array(n));var i=/*#__PURE__*/function(){function n(n,t,i){this.id=void 0,this.domain=void 0,this.action=void 0,this.data=void 0,this.domain=n,this.action=t,this.data=i,this.id=this.generateId()}return n.prototype.generateId=function(){return((n,t,i)=>{let o=(2<<Math.log(n.length-1)/Math.LN2)-1,e=-~(1.6*o*16/n.length);return()=>{let t="";for(;;){let r=i(e),u=e;for(;u--;)if(t+=n[r[u]&o]||"",16===t.length)return t}}})("1234567890",0,t)()},n}(),o=/*#__PURE__*/function(){function n(n){this.resolve=void 0,this.reject=void 0,this.sandboxEvent=void 0,this.sandboxEvent=n}var t=n.prototype;return t.createPromise=function(){var n=this;return new Promise(function(t,i){n.resolve=t,n.reject=i})},t.resolvePromise=function(n){this.resolve(n)},t.rejectPromise=function(n){this.reject(n)},n}(),e=/*#__PURE__*/function(){function n(){this.DOMAIN="extension",this.ACTIONS={GET_ALL_WINDOWS:"getAllWindows",ON_BOUNDS_CHANGED_WINDOWS:"onBoundsChangedWindows",ON_CREATED_WINDOWS:"onCreatedWindows",ON_FOCUS_CHANGED_WINDOWS:"onFocusChangedWindows",ON_REMOVED_WINDOWS:"onRemovedWindows"},this.pendingRequests=void 0}var t=n.prototype;return t.getAll=function(){try{var n=this,t=new i(n.DOMAIN,n.ACTIONS.GET_ALL_WINDOWS),e=new o(t);return n.pendingRequests.push(e),s(t),Promise.resolve(e.createPromise())}catch(n){return Promise.reject(n)}},t.onBoundsChanged=function(n,t){t(n)},t.onCreated=function(n,t){t(n)},t.onFocusChanged=function(n,t){t(n)},t.onRemoved=function(n,t){t(n)},t.registerCallback=function(n){n()},t.onSandboxEvent=function(n){if(n.domain===this.DOMAIN&&n.action===this.ACTIONS.GET_ALL_WINDOWS){var t=this.pendingRequests.find(function(t){return t.sandboxEvent.id===n.id});t?t.resolvePromise(n.data):t.rejectPromise("Cannot resolve event.")}},t.onIframeEvent=function(n){var t=null;return n===this.ACTIONS.GET_ALL_WINDOWS&&(t=this.getAll()),t},n}(),r=/*#__PURE__*/function(){function n(){this.windows=new e}var t=n.prototype;return t.onSandboxEvent=function(n){this.windows.onSandboxEvent(n)},t.onIframeEvent=function(n){return this.windows.onIframeEvent(n)},n}(),u=/*#__PURE__*/function(){function n(){}return n.onSandboxEvent=function(n){return this.chrome.onSandboxEvent(n)},n.onIframeEvent=function(n){return this.chrome.onIframeEvent(n)},n}();function s(n){fetch("tabjail.event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}function f(n){return u.onIframeEvent(n)}u.chrome=new r,n.onIframeEvent=f,n.onSandboxEvent=function(n){return u.onSandboxEvent(n)},n.registerIframeCallback=function(){window.addEventListener("message",function(n){return f(n.data)},!1)},n.sendSandboxEvent=s});
//# sourceMappingURL=tj-comm.umd.js.map
