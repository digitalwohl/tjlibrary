!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n||self).tjComm={})}(this,function(n){function t(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,i(n,t)}function i(n,t){return i=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n},i(n,t)}let o=n=>crypto.getRandomValues(new Uint8Array(n));var s=/*#__PURE__*/function(){function n(n,t,i){this.id=void 0,this.domain=void 0,this.action=void 0,this.data=void 0,this.domain=n,this.action=t,this.data=i,this.id=this.generateId()}return n.prototype.generateId=function(){return((n,t,i)=>{let o=(2<<Math.log(n.length-1)/Math.LN2)-1,s=-~(1.6*o*16/n.length);return()=>{let t="";for(;;){let e=i(s),r=s;for(;r--;)if(t+=n[e[r]&o]||"",16===t.length)return t}}})("1234567890",0,o)()},n}(),e=/*#__PURE__*/function(){function n(){this.PARENT_TARGET_ORIGIN="https://localhost/tabjail/sandbox"}return n.prototype.sendSandboxEvent=function(n){window.parent.postMessage(n,this.PARENT_TARGET_ORIGIN)},n}(),r=/*#__PURE__*/function(){function n(n){this.resolve=void 0,this.reject=void 0,this.sandboxEvent=void 0,this.sandboxEvent=n}var t=n.prototype;return t.createPromise=function(){var n=this;return new Promise(function(t,i){n.resolve=t,n.reject=i})},t.resolvePromise=function(n){this.resolve(n)},t.rejectPromise=function(n){this.reject(n)},n}(),u=/*#__PURE__*/function(n){function i(){for(var t,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return(t=n.call.apply(n,[this].concat(o))||this).DOMAIN="extension",t.ACTIONS={GET_ALL_WINDOWS:"getAllWindows",ON_BOUNDS_CHANGED_WINDOWS:"onBoundsChangedWindows",ON_CREATED_WINDOWS:"onCreatedWindows",ON_FOCUS_CHANGED_WINDOWS:"onFocusChangedWindows",ON_REMOVED_WINDOWS:"onRemovedWindows"},t.pendingRequests=[],t.onBoundsChangedCallbacks=[],t.onCreatedCallbacks=[],t.onFocusChangedCallbacks=[],t.onRemovedCallbacks=[],t}t(i,n);var o=i.prototype;return o.getAll=function(){var n=new s(this.DOMAIN,this.ACTIONS.GET_ALL_WINDOWS),t=new r(n);return this.pendingRequests.push(t),this.sendSandboxEvent(n),t.createPromise()},o.onBoundsChanged=function(n){this.onBoundsChangedCallbacks.push(n)},o.onCreated=function(n){this.onCreatedCallbacks.push(n)},o.onFocusChanged=function(n){this.onFocusChangedCallbacks.push(n)},o.onRemoved=function(n){this.onRemovedCallbacks.push(n)},o.onEventFromSandbox=function(n){if(n.domain===this.DOMAIN)switch(n.action){case this.ACTIONS.GET_ALL_WINDOWS:var t=this.pendingRequests.find(function(t){return t.sandboxEvent.id===n.id}),i=this.pendingRequests.findIndex(function(t){return t.sandboxEvent.id===n.id});t&&(t.resolvePromise(n.data),this.pendingRequests.splice(i,1));break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onBoundsChangedCallbacks.forEach(function(t){return t(n.data)});break;case this.ACTIONS.ON_CREATED_WINDOWS:this.onCreatedCallbacks.forEach(function(t){return t(n.data)});break;case this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS:this.onFocusChangedCallbacks.forEach(function(t){return t(n.data)});break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onRemovedCallbacks.forEach(function(t){return t(n.data)})}},i}(e),h=/*#__PURE__*/function(){function n(){this.windows=new u}return n.prototype.onEventFromSandbox=function(n){this.windows.onEventFromSandbox(n)},n}(),f=/*#__PURE__*/function(n){function i(){for(var t,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return(t=n.call.apply(n,[this].concat(o))||this).DOMAIN="sandbox",t.ACTIONS={JAIL_PAGE:"jailPage",READY:"isReady"},t.pendingRequests=[],t}t(i,n);var o=i.prototype;return o.ready=function(){var n=new s(this.DOMAIN,this.ACTIONS.JAIL_PAGE),t=new r(n);return this.pendingRequests.push(t),this.sendSandboxEvent(n),this.registerSandboxEventsListener(),t.createPromise()},o.onEventFromSandbox=function(n){if(n.domain===this.DOMAIN&&n.action===this.ACTIONS.READY){var t=this.pendingRequests.find(function(t){return t.sandboxEvent.id===n.id}),i=this.pendingRequests.findIndex(function(t){return t.sandboxEvent.id===n.id});t&&(t.resolvePromise(!0),this.pendingRequests.splice(i,1))}},o.registerSandboxEventsListener=function(){window.addEventListener("message",function(n){a.onEventFromSandbox(n.data)},!1)},i}(e),c=/*#__PURE__*/function(){function n(){this.general=new f}return n.prototype.onEventFromSandbox=function(n){this.general.onEventFromSandbox(n)},n}(),a=/*#__PURE__*/function(){function n(){}return n.onEventFromSandbox=function(n){this.sandbox.onEventFromSandbox(n),this.chrome.onEventFromSandbox(n)},n}();a.chrome=new h,a.sandbox=new c,n.TJ=a});
//# sourceMappingURL=tj-comm.umd.js.map
