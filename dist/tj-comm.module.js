function t(n,i){return t=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},t(n,i)}let n=t=>crypto.getRandomValues(new Uint8Array(t));var i=/*#__PURE__*/function(){function t(t,n,i){this.STRING_SEPARATOR="#",this.id=void 0,this.domain=void 0,this.action=void 0,this.data=void 0,this.domain=t,this.action=n,this.data=i,this.id=this.generateId()}var i=t.prototype;return i.generateId=function(){return((t,n,i)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*r*16/t.length);return()=>{let n="";for(;;){let s=i(o),u=o;for(;u--;)if(n+=t[s[u]&r]||"",16===n.length)return n}}})("1234567890",0,n)()},i.toString=function(){return""+this.id+this.STRING_SEPARATOR+this.domain+this.STRING_SEPARATOR+this.action},t}(),r=/*#__PURE__*/function(){function t(){this.PARENT_TARGET_ORIGIN="https://localhost/tabjail/sandbox"}return t.prototype.sendSandboxEvent=function(t){window.parent.postMessage(t,this.PARENT_TARGET_ORIGIN)},t}(),o=/*#__PURE__*/function(){function t(t){this.resolve=void 0,this.reject=void 0,this.sandboxEvent=void 0,this.sandboxEvent=t}var n=t.prototype;return n.createPromise=function(){var t=this;return new Promise(function(n,i){t.resolve=n,t.reject=i})},n.resolvePromise=function(t){this.resolve(t)},n.rejectPromise=function(t){this.reject(t)},t}(),s=/*#__PURE__*/function(n){var r,s;function u(){for(var t,i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=n.call.apply(n,[this].concat(r))||this).DOMAIN="extension",t.ACTIONS={GET_ALL_WINDOWS:"getAllWindows",ON_BOUNDS_CHANGED_WINDOWS:"onBoundsChangedWindows",ON_CREATED_WINDOWS:"onCreatedWindows",ON_FOCUS_CHANGED_WINDOWS:"onFocusChangedWindows",ON_REMOVED_WINDOWS:"onRemovedWindows"},t.pendingRequests=[],t.onBoundsChangedCallbacks=[],t.onCreatedCallbacks=[],t.onFocusChangedCallbacks=[],t.onRemovedCallbacks=[],t}s=n,(r=u).prototype=Object.create(s.prototype),r.prototype.constructor=r,t(r,s);var e=u.prototype;return e.getAll=function(){try{var t=this,n=new i(t.DOMAIN,t.ACTIONS.GET_ALL_WINDOWS),r=new o(n);t.pendingRequests.push(r),t.sendSandboxEvent(n);var s=r.createPromise();return Promise.resolve(s)}catch(t){return Promise.reject(t)}},e.onBoundsChanged=function(t){this.onBoundsChangedCallbacks.push(t)},e.onCreated=function(t){this.onCreatedCallbacks.push(t)},e.onFocusChanged=function(t){this.onFocusChangedCallbacks.push(t)},e.onRemoved=function(t){this.onRemovedCallbacks.push(t)},e.onEventFromSandbox=function(t){if(t.domain===this.DOMAIN)switch(t.action){case this.ACTIONS.GET_ALL_WINDOWS:var n=this.pendingRequests.find(function(n){return n.sandboxEvent.id===t.id});n&&n.resolvePromise(t);break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onBoundsChangedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_CREATED_WINDOWS:this.onCreatedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS:this.onFocusChangedCallbacks.forEach(function(n){return n(t.data)});break;case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:this.onRemovedCallbacks.forEach(function(n){return n(t.data)})}},u}(r),u=/*#__PURE__*/function(){function t(){this.windows=new s}return t.prototype.onEventFromSandbox=function(t){this.windows.onEventFromSandbox(t)},t}(),e=/*#__PURE__*/function(){function t(){}return t.onEventFromSandbox=function(t){this.chrome.onEventFromSandbox(t)},t}();function h(){window.addEventListener("message",function(t){e.onEventFromSandbox(t.data)},!1)}e.chrome=new u;var c=e;export{c as TJ,h as listenForSandboxEvents};
//# sourceMappingURL=tj-comm.module.js.map
