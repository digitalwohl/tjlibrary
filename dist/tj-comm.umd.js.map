{"version":3,"file":"tj-comm.umd.js","sources":["../src/model/sandbox-event.ts","../src/model/sandbox-event-promise.ts","../src/api/chrome/windows/windows.ts","../src/api/chrome/chrome.ts","../src/api/api.ts","../src/index.ts"],"sourcesContent":["import { customAlphabet } from 'nanoid';\n\n/**\n *  Event that is sent across the sandbox event bus,\n *  it can be exchanged with the sandbox page\n * \n * @class SandboxEvent\n */\nexport default class SandboxEvent {\n    id: string;\n    domain: string;\n    action: string;\n    data: object;\n\n    /**\n     * Creates an instance of SandboxEvent.\n     * @param {string} domain\n     * @param {string} action\n     * @param {object} data\n     * @memberof SandboxEvent\n     */\n    constructor(domain: string, action: string, data?: object) {\n        this.domain = domain;\n        this.action = action;\n        this.data = data;\n        this.id = this.generateId();\n    }\n\n    /**\n     * Generates a random event id,\n     * used to track events when exchanged with the sandbox\n     *\n     * @return {string} \n     * @memberof SandboxEvent\n     */\n    private generateId() {\n        const nanoid = customAlphabet('1234567890', 16);\n        return nanoid();\n    }\n}\n","import SandboxEvent from \"./sandbox-event\";\n\nexport default class SandboxEventPromise {\n    // public promiseId: string;\n    private resolve: (value: any) => void;\n    private reject: (reason?: any) => void;\n    public sandboxEvent: SandboxEvent;\n    \n    constructor(sandboxEvent: SandboxEvent) {\n        this.sandboxEvent = sandboxEvent;\n        // this.promiseId = this.sandboxEvent.id;\n    }\n\n    public createPromise(): Promise<any> {\n        return new Promise( (resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n\n    public resolvePromise(data: any): void {\n        this.resolve(data);\n    }\n\n    public rejectPromise(reason: string) :void {\n        this.reject(reason);\n    }\n}","import { sendSandboxEvent } from \"../../..\";\nimport SandboxEvent from \"../../../model/sandbox-event\";\nimport SandboxEventPromise from \"../../../model/sandbox-event-promise\";\n\nexport default class Windows {\n\n    private DOMAIN = 'extension';\n    private ACTIONS = {\n        GET_ALL_WINDOWS: 'getAllWindows',\n        ON_BOUNDS_CHANGED_WINDOWS: 'onBoundsChangedWindows',\n        ON_CREATED_WINDOWS: 'onCreatedWindows',\n        ON_FOCUS_CHANGED_WINDOWS: 'onFocusChangedWindows',\n        ON_REMOVED_WINDOWS: 'onRemovedWindows'\n    }\n\n    private pendingRequests: SandboxEventPromise[];\n\n    public async getAll(): Promise<chrome.windows.Window[]> {\n        const sandboxEvent = new SandboxEvent(this.DOMAIN, this.ACTIONS.GET_ALL_WINDOWS);\n        const sandboxEventPromise = new SandboxEventPromise(sandboxEvent);\n        this.pendingRequests.push(sandboxEventPromise);\n        sendSandboxEvent(sandboxEvent);\n        return sandboxEventPromise.createPromise();\n    }\n\n    // public async update(windowId: string, updateInfo: chrome.windows.UpdateInfo): Promise<chrome.windows.Window> {\n    //     const sandboxEvent = new SandboxEvent('extension','updateWindows', {windowId: windowId, updateInfo: updateInfo});\n    //     const sandboxEventPromise = new SandboxEventPromise(sandboxEvent);\n    //     this.pendingRequests.push(sandboxEventPromise);\n    //     return sandboxEventPromise.createPromise();\n    // }\n\n    public onBoundsChanged(window: chrome.windows.Window, callback: Function): void {\n        callback(window);\n    }\n\n    public onCreated(window: chrome.windows.Window, callback: Function): void {\n        callback(window);\n    }\n\n    public onFocusChanged(windowId: number, callback: Function): void {\n        callback(windowId);\n    }\n\n    public onRemoved(windowId: number, callback: Function): void {\n        callback(windowId);\n    }\n\n    public registerCallback(callback: Function) {\n        callback();\n    }\n\n    public onSandboxEvent(sandboxEvent: SandboxEvent): void {\n        if (sandboxEvent.domain === this.DOMAIN) {\n            switch (sandboxEvent.action) {\n                case this.ACTIONS.GET_ALL_WINDOWS:\n                    const sandboxEventPromise = this.pendingRequests.find(request => request.sandboxEvent.id === sandboxEvent.id);\n                    if(sandboxEventPromise) {\n                        sandboxEventPromise.resolvePromise(sandboxEvent.data);\n                    } else {\n                        sandboxEventPromise.rejectPromise('Cannot resolve event.');\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n\n    public onIframeEvent(eventName: string): Promise<any> {\n        let responsePromise = null;\n        switch (eventName) {\n            case this.ACTIONS.GET_ALL_WINDOWS:\n                responsePromise = this.getAll();\n                break;\n            default:\n                break;\n        }\n        return responsePromise;\n    }\n}","import sandboxEvent from \"../../model/sandbox-event\";\nimport Windows from \"./windows/windows\";\n\nexport default class Chrome {\n\n    public windows = new Windows();\n\n    onSandboxEvent(sandboxEvent: sandboxEvent): void {\n        this.windows.onSandboxEvent(sandboxEvent);\n    }\n\n    onIframeEvent(eventName: string): Promise<any> {\n        return this.windows.onIframeEvent(eventName);\n    }\n}","import sandboxEvent from \"../model/sandbox-event\";\nimport Chrome from \"./chrome/chrome\";\n\nexport default class Api {\n    static chrome = new Chrome();\n    \n    static onSandboxEvent(sandboxEvent: sandboxEvent) {\n        return this.chrome.onSandboxEvent(sandboxEvent);\n    }\n\n    static onIframeEvent(eventName: string): Promise<any> {\n        return this.chrome.onIframeEvent(eventName);\n    }\n}","import Api from \"./api/api\";\nimport Windows from \"./api/chrome/windows/windows\";\nimport SandboxEvent from \"./model/sandbox-event\";\n\nconst SANDBOX_EVENT_PATH = 'tabjail.event';\n\nexport function sendSandboxEvent(sandboxEvent: SandboxEvent) {\n    fetch(SANDBOX_EVENT_PATH, {\n        method: \"POST\",\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(sandboxEvent)\n    });\n}\n\n// export function sendExtensionEvent(sandboxEvent: SandboxEvent) {\n//     // @ts-ignore\n//     chrome.runtime.sendMessage(sandboxEvent.data.extensionId, sandboxEvent);\n// }\n\nexport function onSandboxEvent(sandboxEvent: SandboxEvent) {\n    return Api.onSandboxEvent(sandboxEvent);\n}\n\nexport function onIframeEvent(eventName: string): Promise<any> {\n    return Api.onIframeEvent(eventName);\n}\n\nexport function registerIframeCallback(): void {\n    window.addEventListener('message', message => {\n        return onIframeEvent(message.data as string);\n    }, false);\n}\n"],"names":["SandboxEvent","domain","action","data","id","this","generateId","customAlphabet","nanoid","SandboxEventPromise","sandboxEvent","resolve","reject","createPromise","Promise","_this","resolvePromise","rejectPromise","reason","Windows","DOMAIN","ACTIONS","GET_ALL_WINDOWS","ON_BOUNDS_CHANGED_WINDOWS","ON_CREATED_WINDOWS","ON_FOCUS_CHANGED_WINDOWS","ON_REMOVED_WINDOWS","pendingRequests","getAll","_this2","sandboxEventPromise","push","sendSandboxEvent","onBoundsChanged","window","callback","onCreated","onFocusChanged","windowId","onRemoved","registerCallback","onSandboxEvent","find","request","onIframeEvent","eventName","responsePromise","Chrome","windows","Api","chrome","fetch","method","headers","body","JSON","stringify","addEventListener","message"],"mappings":"0QAQqBA,0BAajB,WAAYC,EAAgBC,EAAgBC,QAZ5CC,eACAH,mBACAC,mBACAC,YAUIE,KAAKJ,OAASA,EACdI,KAAKH,OAASA,EACdG,KAAKF,KAAOA,EACZE,KAAKD,GAAKC,KAAKC,gCAUXA,WAAA,WAEJ,OADeC,iBAAe,aAAc,GACrCC,SCnCMC,0BAMjB,WAAYC,QAJJC,oBACAC,mBACDF,oBAGHL,KAAKK,aAAeA,6BAIjBG,cAAA,sBACH,WAAWC,QAAS,SAACH,EAASC,GAC1BG,EAAKJ,QAAUA,EACfI,EAAKH,OAASA,OAIfI,eAAA,SAAeb,GAClBE,KAAKM,QAAQR,MAGVc,cAAA,SAAcC,GACjBb,KAAKO,OAAOM,SCrBCC,4CAETC,OAAS,iBACTC,QAAU,CACdC,gBAAiB,gBACjBC,0BAA2B,yBAC3BC,mBAAoB,mBACpBC,yBAA0B,wBAC1BC,mBAAoB,yBAGhBC,kDAEKC,4BAC6BvB,KAAhCK,EAAe,IAAIV,EAAa6B,EAAKT,OAAQS,EAAKR,QAAQC,iBAC1DQ,EAAsB,IAAIrB,EAAoBC,GAGpD,OAFAmB,EAAKF,gBAAgBI,KAAKD,GAC1BE,EAAiBtB,mBACVoB,EAAoBjB,uDAUxBoB,gBAAA,SAAgBC,EAA+BC,GAClDA,EAASD,MAGNE,UAAA,SAAUF,EAA+BC,GAC5CA,EAASD,MAGNG,eAAA,SAAeC,EAAkBH,GACpCA,EAASG,MAGNC,UAAA,SAAUD,EAAkBH,GAC/BA,EAASG,MAGNE,iBAAA,SAAiBL,GACpBA,OAGGM,eAAA,SAAe/B,GAClB,GAAIA,EAAaT,SAAWI,KAAKe,QACrBV,EAAaR,cACPmB,QAAQC,gBAAlB,CACI,IAAMQ,EAAsBzB,KAAKsB,gBAAgBe,KAAK,SAAAC,UAAWA,EAAQjC,aAAaN,KAAOM,EAAaN,KACvG0B,EACCA,EAAoBd,eAAeN,EAAaP,MAEhD2B,EAAoBb,cAAc,6BAS/C2B,cAAA,SAAcC,GACjB,IAAIC,EAAkB,KAQtB,OAPQD,SACMxB,QAAQC,kBACdwB,EAAkBzC,KAAKuB,UAKxBkB,QC3EMC,4CAEVC,QAAU,IAAI7B,6BAErBsB,eAAA,SAAe/B,GACXL,KAAK2C,QAAQP,eAAe/B,MAGhCkC,cAAA,SAAcC,GACV,YAAYG,QAAQJ,cAAcC,SCTrBI,iDAGVR,eAAP,SAAsB/B,GAClB,YAAYwC,OAAOT,eAAe/B,MAG/BkC,cAAP,SAAqBC,GACjB,YAAYK,OAAON,cAAcC,kBCLzBb,EAAiBtB,GAC7ByC,MAHuB,gBAGG,CACtBC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMC,KAAKC,UAAU9C,cAabkC,EAAcC,GAC1B,OAAOI,EAAIL,cAAcC,GDrBRI,EACVC,OAAS,IAAIH,8CCeOrC,GAC3B,OAAOuC,EAAIR,eAAe/B,wCAQ1BwB,OAAOuB,iBAAiB,UAAW,SAAAC,GAC/B,OAAOd,EAAcc,EAAQvD,QAC9B"}