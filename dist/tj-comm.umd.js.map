{"version":3,"file":"tj-comm.umd.js","sources":["../node_modules/nanoid/index.prod.js","../src/model/sandbox-event.ts","../src/model/sandbox-event-dispatcher.ts","../src/model/sandbox-event-promise.ts","../src/api/chrome/windows/windows.ts","../src/api/chrome/chrome.ts","../src/api/sandbox/general/general.ts","../src/api/sandbox/sandbox.ts","../src/api/api.ts","../src/index.ts"],"sourcesContent":["import { urlAlphabet } from './url-alphabet/index.js'\nif (false) {\n  if (\n    typeof navigator !== 'undefined' &&\n    navigator.product === 'ReactNative' &&\n    typeof crypto === 'undefined'\n  ) {\n    throw new Error(\n      'React Native does not have a built-in secure random generator. ' +\n        'If you don’t need unpredictable IDs use `nanoid/non-secure`. ' +\n        'For secure IDs, import `react-native-get-random-values` ' +\n        'before Nano ID.'\n    )\n  }\n  if (typeof msCrypto !== 'undefined' && typeof crypto === 'undefined') {\n    throw new Error(\n      'Import file with `if (!window.crypto) window.crypto = window.msCrypto`' +\n        ' before importing Nano ID to fix IE 11 support'\n    )\n  }\n  if (typeof crypto === 'undefined') {\n    throw new Error(\n      'Your browser does not have secure random generator. ' +\n        'If you don’t need unpredictable IDs, you can use nanoid/non-secure.'\n    )\n  }\n}\nlet random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nlet customRandom = (alphabet, size, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * size) / alphabet.length)\n  return () => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nlet customAlphabet = (alphabet, size) => customRandom(alphabet, size, random)\nlet nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array(size))\n  while (size--) {\n    let byte = bytes[size] & 63\n    if (byte < 36) {\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte < 63) {\n      id += '_'\n    } else {\n      id += '-'\n    }\n  }\n  return id\n}\nexport { nanoid, customAlphabet, customRandom, urlAlphabet, random }\n","import { customAlphabet } from 'nanoid';\n\n/**\n *  Event that is sent across the sandbox event bus,\n *  it can be exchanged with the sandbox page\n * \n * @class SandboxEvent\n */\nexport default class SandboxEvent {\n    // STRING_SEPARATOR = '#';\n\n    id: string;\n    domain: string;\n    action: string;\n    data: object;\n\n    /**\n     * Creates an instance of SandboxEvent.\n     * @param {string} domain\n     * @param {string} action\n     * @param {object} data\n     * @memberof SandboxEvent\n     */\n    constructor(domain: string, action: string, data?: object) {\n        this.domain = domain;\n        this.action = action;\n        this.data = data;\n        this.id = this.generateId();\n    }\n\n    /**\n     * Generates a random event id,\n     * used to track events when exchanged with the sandbox\n     *\n     * @return {string} \n     * @memberof SandboxEvent\n     */\n    private generateId() {\n        const nanoid = customAlphabet('1234567890', 16);\n        return nanoid();\n    }\n\n    // public toString():string {\n    //     return `${this.id}${this.STRING_SEPARATOR}${this.domain}${this.STRING_SEPARATOR}${this.action}`;\n    // }\n}\n","import SandboxEvent from \"./sandbox-event\";\n\nexport default class SandboxEventDispatcher {\n    private PARENT_TARGET_ORIGIN = 'https://localhost/tabjail/sandbox';\n\n    public sendSandboxEvent(sandboxEvent: SandboxEvent) {\n        window.parent.postMessage(sandboxEvent, this.PARENT_TARGET_ORIGIN);\n    }\n\n    public registerSubscription(domain:string, action: string) {\n        const sandboxEvent = new SandboxEvent(domain, action);\n        this.sendSandboxEvent(sandboxEvent);\n    }\n}","import SandboxEvent from \"./sandbox-event\";\n\nexport default class SandboxEventPromise {\n    private resolve: (value: any) => void;\n    private reject: (reason?: any) => void;\n    public sandboxEvent: SandboxEvent;\n    \n    constructor(sandboxEvent: SandboxEvent) {\n        this.sandboxEvent = sandboxEvent;\n    }\n\n    public createPromise(): Promise<any> {\n        return new Promise( (resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n\n    public resolvePromise(data: any): void {\n        this.resolve(data);\n    }\n\n    public rejectPromise(reason: string) :void {\n        this.reject(reason);\n    }\n}","import SandboxEvent from \"../../../model/sandbox-event\";\nimport SandboxEventDispatcher from \"../../../model/sandbox-event-dispatcher\";\nimport SandboxEventPromise from \"../../../model/sandbox-event-promise\";\n\nexport default class Windows extends SandboxEventDispatcher{\n\n    private DOMAIN = 'extension';\n    private ACTIONS = {\n        GET_ALL_WINDOWS: 'getAllWindows',\n        ON_BOUNDS_CHANGED_WINDOWS: 'onBoundsChangedWindows',\n        ON_CREATED_WINDOWS: 'onCreatedWindows',\n        ON_FOCUS_CHANGED_WINDOWS: 'onFocusChangedWindows',\n        ON_REMOVED_WINDOWS: 'onRemovedWindows'\n    }\n\n    private pendingRequests: SandboxEventPromise[] = [];\n\n    public getAll(): Promise<chrome.windows.Window[]> {\n        const sandboxEvent = new SandboxEvent(this.DOMAIN, this.ACTIONS.GET_ALL_WINDOWS);\n        const sandboxEventPromise = new SandboxEventPromise(sandboxEvent);\n        this.pendingRequests.push(sandboxEventPromise);\n        this.sendSandboxEvent(sandboxEvent);\n        return sandboxEventPromise.createPromise();\n    }\n\n    // public async update(windowId: string, updateInfo: chrome.windows.UpdateInfo): Promise<chrome.windows.Window> {\n    //     const sandboxEvent = new SandboxEvent('extension','updateWindows', {windowId: windowId, updateInfo: updateInfo});\n    //     const sandboxEventPromise = new SandboxEventPromise(sandboxEvent);\n    //     this.pendingRequests.push(sandboxEventPromise);\n    //     return sandboxEventPromise.createPromise();\n    // }\n\n\n    private onBoundsChangedCallbacks: Function[] = [];\n    public onBoundsChanged(callback: Function): void {\n        this.registerSubscription(this.DOMAIN, this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS);\n        this.onBoundsChangedCallbacks.push(callback);\n    }\n\n    private onCreatedCallbacks: Function[] = [];\n    public onCreated(callback: Function): void {\n        this.registerSubscription(this.DOMAIN, this.ACTIONS.ON_CREATED_WINDOWS);\n        this.onCreatedCallbacks.push(callback);\n    }\n\n    private onFocusChangedCallbacks: Function[] = [];\n    public onFocusChanged(callback: Function): void {\n        this.registerSubscription(this.DOMAIN, this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS);\n        this.onFocusChangedCallbacks.push(callback);\n    }\n\n    private onRemovedCallbacks: Function[] = [];\n    public onRemoved(callback: Function): void {\n        this.registerSubscription(this.DOMAIN, this.ACTIONS.ON_REMOVED_WINDOWS);\n        this.onRemovedCallbacks.push(callback);\n    }\n\n    public onEventFromSandbox(sandboxEvent: SandboxEvent): void {\n        if (sandboxEvent.domain === this.DOMAIN) {\n            switch (sandboxEvent.action) {\n                case this.ACTIONS.GET_ALL_WINDOWS:\n                    const foundPromise = this.pendingRequests.find(request => request.sandboxEvent.id === sandboxEvent.id);\n                    const fountPromiseIndex = this.pendingRequests.findIndex(request => request.sandboxEvent.id === sandboxEvent.id);\n                    if (foundPromise) {\n                        foundPromise.resolvePromise(sandboxEvent.data);\n                        this.pendingRequests.splice(fountPromiseIndex, 1);\n                    }\n                    break;\n                case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:\n                    this.onBoundsChangedCallbacks.forEach(callback => callback(sandboxEvent.data));\n                    break;\n                case this.ACTIONS.ON_CREATED_WINDOWS:\n                    this.onCreatedCallbacks.forEach(callback => callback(sandboxEvent.data));\n                    break;\n                case this.ACTIONS.ON_FOCUS_CHANGED_WINDOWS:\n                    this.onFocusChangedCallbacks.forEach(callback => callback(sandboxEvent.data));\n                    break;\n                case this.ACTIONS.ON_BOUNDS_CHANGED_WINDOWS:\n                    this.onRemovedCallbacks.forEach(callback => callback(sandboxEvent.data));\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n    \n}","import SandboxEvent from \"../../model/sandbox-event\";\nimport Windows from \"./windows/windows\";\n\nexport default class Chrome {\n\n    public windows = new Windows();\n\n    onEventFromSandbox(sandboxEvent: SandboxEvent): void {\n        this.windows.onEventFromSandbox(sandboxEvent);\n    }\n}","import SandboxEvent from \"../../../model/sandbox-event\";\nimport SandboxEventDispatcher from \"../../../model/sandbox-event-dispatcher\";\nimport SandboxEventPromise from \"../../../model/sandbox-event-promise\";\nimport Api from \"../../api\";\n\nexport default class General extends SandboxEventDispatcher {\n\n    private DOMAIN = 'sandbox';\n    private ACTIONS = {\n        JAIL_PAGE: 'jailPage',\n        READY: 'isReady'\n    }\n\n    private pendingRequests: SandboxEventPromise[] = [];\n\n    public ready(): Promise<boolean> {\n        const sandboxEvent = new SandboxEvent(this.DOMAIN, this.ACTIONS.JAIL_PAGE);\n        const sandboxEventPromise = new SandboxEventPromise(sandboxEvent);\n        this.pendingRequests.push(sandboxEventPromise);\n        this.sendSandboxEvent(sandboxEvent);\n        this.registerSandboxEventsListener();\n        return sandboxEventPromise.createPromise();\n    }\n\n    public onEventFromSandbox(sandboxEvent: SandboxEvent): void {\n        if (sandboxEvent.domain === this.DOMAIN) {\n            switch (sandboxEvent.action) {\n                case this.ACTIONS.READY:\n                    const foundPromise = this.pendingRequests.find(request => request.sandboxEvent.id === sandboxEvent.id);\n                    const fountPromiseIndex = this.pendingRequests.findIndex(request => request.sandboxEvent.id === sandboxEvent.id);\n                    if (foundPromise) {\n                        foundPromise.resolvePromise(true);\n                        this.pendingRequests.splice(fountPromiseIndex, 1);\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n    }\n\n    private registerSandboxEventsListener(): void {\n        window.addEventListener('message', message => {\n            Api.onEventFromSandbox(message.data as SandboxEvent);\n        }, false);\n    }\n\n}","import SandboxEvent from \"../../model/sandbox-event\";\nimport General from \"./general/general\";\n\nexport default class Sandbox {\n\n    public general = new General();\n\n    onEventFromSandbox(sandboxEvent: SandboxEvent): void {\n        this.general.onEventFromSandbox(sandboxEvent);\n    }\n}","import SandboxEvent from \"../model/sandbox-event\";\nimport Chrome from \"./chrome/chrome\";\nimport Sandbox from \"./sandbox/sandbox\";\n\nexport default class Api {\n    static chrome = new Chrome();\n    static sandbox = new Sandbox();\n\n    static onEventFromSandbox(sandboxEvent: SandboxEvent): void {\n        this.sandbox.onEventFromSandbox(sandboxEvent);\n        this.chrome.onEventFromSandbox(sandboxEvent);\n    }\n}","import Api from \"./api/api\";\n\nexport const TJ = Api;"],"names":["random","bytes","crypto","getRandomValues","Uint8Array","SandboxEvent","domain","action","data","id","this","generateId","alphabet","size","getRandom","mask","Math","log","length","LN2","step","j","customRandom","nanoid","SandboxEventDispatcher","PARENT_TARGET_ORIGIN","sendSandboxEvent","sandboxEvent","window","parent","postMessage","registerSubscription","SandboxEventPromise","resolve","reject","createPromise","Promise","_this","resolvePromise","rejectPromise","reason","Windows","DOMAIN","ACTIONS","GET_ALL_WINDOWS","ON_BOUNDS_CHANGED_WINDOWS","ON_CREATED_WINDOWS","ON_FOCUS_CHANGED_WINDOWS","ON_REMOVED_WINDOWS","pendingRequests","onBoundsChangedCallbacks","onCreatedCallbacks","onFocusChangedCallbacks","onRemovedCallbacks","getAll","sandboxEventPromise","push","onBoundsChanged","callback","onCreated","onFocusChanged","onRemoved","onEventFromSandbox","foundPromise","find","request","fountPromiseIndex","findIndex","splice","forEach","Chrome","windows","General","JAIL_PAGE","READY","ready","registerSandboxEventsListener","addEventListener","message","Api","Sandbox","general","sandbox","chrome"],"mappings":"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"}